<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Johann de Boer" />

<meta name="date" content="2018-06-07" />

<title>Interactively querying Google Analytics reports</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Interactively querying Google Analytics reports</h1>
<h4 class="author"><em>Johann de Boer</em></h4>
<h4 class="date"><em>2018-06-07</em></h4>



<!-- README.md is generated from README.rmd. Please edit that file -->
<div id="ganalytics" class="section level1">
<h1>ganalytics</h1>
<p><a href="https://travis-ci.org/jdeboer/ganalytics"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAUCAYAAAAN+ioeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAABQBJREFUWIXdmH1ME2cAxp/76FF6DBhYIESgbHNJFRlMqIAIcWMjbhNs1pj0Dwgmi+jm4j70Dz/mHKvZnBl1cYBLE9YYCJNNggs6s/hFNGBjthCJHyPqFkFCVAKDtZSud+/+YDto7cdJmVSf5E3vvd/d0+d9cndpjzIYDJEcx5kVCoURQDTCQH++c36+I8yNXDQhg/wV+8h4IctxnJll2WpCyHzHkhROWUKSQqCQNpahIlEXWIZhjOG2sHDLE6qoJMcSlhASFo+LmXrSiiacm2LDcVHhmClU0YQQ+BtNTU1+mdwRyGMu/B+XEbBoALMybW5uluUxW///e3QU3J5zz6CPjmDcl4qLi5GcnCzLwxebzXfOpXL3L4A6XzmnnkGvaKPRCKvVCpPJBLVaLbGWlhaPY2fOOzs7fV61arUaJpMJVqsVRqPRgwUaJwoHsF6zHW35fTjwQgcSI1Ie4McL+9GY04Xs2CJpf0H8ajS8eBrHCm7BmnsRpYlGWezStvse3saULfg+7xoO515CztOrJJYUkYqvso6jLb8P6zXbcaJwwO8aghZtt9uh1+ths9lQUVHh97afOfe3XVlZie7ubuj1ejidTtlFA4BjZBKldYvR3XcOGzR7PPiyffHQfZGAPR2bUa2pkfZveXY/PvtpK1aaU/FW0xt4js2Wxbzzi+M0VtctwZendmKD5hOJVWtqcP76KZTWLYZz1B1wPUGLPnr0KHieR1tbG7RabUhFa7VatLe3g+d5tLa2PlTRLdfqEZExiZabX2NpTJ7EsmOL8MPmC+jeOohDhh+xkE+X2LHLzfiwZC92GfdBm/U89p7dIot55z/ca4Zy6d+wuU4iWaWR2JIYHVpvTuVqvnowtKJVKpXH539MFEVQFAVCCBQKhayiA/kFyxGZwAA0QWQCA0Kmz/tgUS0OnvkUheYUrKxNAU0xEmu48jG2tVfhRn8fKtO3wfT6IVnMOzOd6AZoAjZWBE3R04wAyqTpXCEVvWbNGiiVSpSXl6Onp0dig4OD0Ol04DgOZWVlsoru6enx8HuYog2pGxFJ81iX9jZ+7e+SGAclhBg7EnJ4vG/Y7eG54xUzotM5tP/eCPPZj7AsZpUs5p0f1L9Z4LWeOza8mVKNSJqHIW1TaEWLogiLxYKMjAw0NDRIrK6uDlVVVbBYLJiYmJBVdH19PTIzM2GxWOB2B36meecgDhpHVvQi66kimG07JFZ7bidq8hrxbV4XhoeHPTwv3/oFn+d8h5/X/YFdrx5Azcl3ZTF/+b3n5os7kBtTgiMresE5VXC47H7XQOn1er+/pYaGhsDzPBwOB1iWRWxsLBhm6haZnJzE2NgYRFFEVFQUxsfHkZSUJJ3na1sQBIyOjsLtdkOlUsFut0tsprzf3p1++R7yrXGYGBLARlKIWsSCiaCmctwTYb8tABSgTKQxMSAgfjkHAHDeFTExKEB0ETBKCqqFDLg4Oigbtrkkj5nb3nPBSTB+ww3apUBF8UasTH4NW38r89kltXbt2rD7v+td9JmS+3jp1IJ5ShNYZ0ruQyQCbo1ex+6TmzCkvurzuMfiXUemKRrxyxXzlCawMk3RAAWwKgr8MwxYQvk8jiWE/AUg6tHGCyzvouN07AP7wkVxOtZj7isn7WIJS9N0syAI1Y8qmByFa6mzFXs3ppceGRl5j2GYbyiKGpvvQE+aaBdLIu4suEzuiUX/AG3EJVuesFjhAAAAAElFTkSuQmCC" alt="Travis-CI Build Status" /></a></p>
<p>Classes and methods for interactive use of the Google Analytics core reporting, real-time reporting, multi-channel funnel reporting, metadata, configuration management and Google Tag Manager APIs.</p>
<p>The aim of this package is to support R users in defining reporting queries using natural R expressions instead of being concerned about API technical intricacies like query syntax, character code escaping and API limitations.</p>
<p>This package provides functions for querying the Google Analytics core reporting, real-time reporting, multi-channel funnel reporting and management APIs, as well as the Google Tag Manager API. Write methods are also provided for the Google Analytics Management and Google Tag Manager APIs so that you can, for example, change tag, property or view settings.</p>
<div id="updates" class="section level2">
<h2>Updates</h2>
<p>Support for GoogleAnalyticsR integration is now available for segments and table filter objects. You can supply these objects to the <code>google_analytics</code> function in GoogleAnalyticsR by using <code>as()</code>, supplying the appropriate GoogleAnalyticsR class names, which are <code>&quot;segment_ga4&quot;</code> for segments and <code>&quot;.filter_clauses_ga4&quot;</code> for table filters. Soon GoogleanalyticsR will implictly coerce ganalytics segments and table filters so that you do not need to explictly coerce using <code>as()</code>.</p>
<p>Many new functions have been provided for writing segmentation expressions:</p>
<ul>
<li><code>Segments(...)</code> - define a list of segments dynamically based on one or more expressions and/or a selection of built-in and/or custom segments by their IDs.</li>
<li><code>Include(...)</code> - expressions (conditions or sequences) defining users or sessions to include in the segment</li>
<li><code>Exclude(...)</code> - expressions (conditions or sequences) defining users or sessions to exclude from the segment</li>
<li><code>PerUser(...)</code> - set the scope of one or more segment conditions or sequences to user-level, or set the scope of a metric condition to user-level.</li>
<li><code>PerSession(...)</code> - set the scope of one or more segment conditions or sequences to user-level, or set the scope of a metric condition to session-level.</li>
<li><code>PerHit(...)</code> - specify that a set of logically combined conditions must all be met for a single hit, or set the scope of a metric condition to hit-level.</li>
<li><code>Sequence(...)</code> - define a sequence of one or more conditions to use in a dynamic segment definition.</li>
<li><code>Then(condition)</code> - used within a <code>Sequence()</code> to specify that this condition must immediately follow the preceding condition, as opposed to the default of loosely following at some point later.</li>
<li><code>Later(condition)</code> - similar to <code>Then()</code> but means that a condition can happen any point after the preceding condition - this is how conditions are treated by default in a sequence if not explicitly set.</li>
<li><code>First(condition)</code> - similar to <code>Then()</code> but means that a condition must be the first interaction (hit) by the user within the specified date-range. Using <code>First()</code> is optional. Without using <code>First()</code> at the start of a sequence, then the first condition does not need to match the first interaction by the user. It does not make sense to use <code>First()</code> anywhere else in the sequence other than at the start, if used at all.</li>
</ul>
<p>Multi-channel funnel (MCF) and real-time (RT) queries can now be constructed, but work is still needed to process the response from these queries - stay tuned for updates on this.</p>
<p>Instead of using <code>Or</code>, <code>And</code>, and <code>Not</code>, it is now possible to use familiar R language Boolean operators, <code>|</code> (<code>Or</code>), <code>&amp;</code> (<code>And</code>), and <code>!</code> (<code>Not</code>) instead (thanks to <span class="citation">@hadley</span> for suggestion <a href="https://github.com/jdeboer/ganalytics/issues/2">#2</a>). It is important to keep in mind however that Google Analytics requires <code>Or</code> to have precedence over <code>And</code>, which is the opposite to the natural precedence given by R when using the <code>|</code> and <code>&amp;</code> operators. Therefore, remember to use parentheses <code>(</code> <code>)</code> to enforce the correct order of operation to your Boolean expressions. For example <code>my_filter &lt;- !bounced &amp; (completed_goal | transacted)</code> is a valid structure for a Google Analytics reporting API filter expression.</p>
<p>You can use query the Google Analytics Management API to obtain details in R about the configuration of your accounts, properties and views, such as goals you have defined. There are <em>write</em> methods available too, but these have not been fully tested so use with extreme care. If you wish to use these functions, it is recommended that you test these using test login, otherwise avoid using the “INSERT”, “UPDATE” and “DELETE” methods.</p>
<p>There is also some basic support for the Google Tag Manager API, but again, this is a work in progress so take care with the write methods above.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<div id="install-the-necessary-packages-into-r-via-the-github-repository" class="section level3">
<h3>1. Install the necessary packages into R via the GitHub repository</h3>
<div id="prerequisites" class="section level4">
<h4>Prerequisites</h4>
<ul>
<li>Ensure you have installed the latest version of <a href="https://cran.r-project.org/">R</a></li>
</ul>
</div>
<div id="execute-the-following-statements-in-r-to-install-ganalytics" class="section level4">
<h4>Execute the following statements in R to install ganalytics:</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Install the latest version of remotes via CRAN</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># Install ganalytics via the GitHub repository.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;jdeboer/ganalytics&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># End</span></a></code></pre></div>
</div>
</div>
<div id="prepare-your-google-api-application-you-only-need-to-do-this-once" class="section level3">
<h3>2. Prepare your Google API application <em>(you only need to do this once)</em></h3>
<ul>
<li>Browse to [<strong>Google API Console</strong>] (<a href="https://code.google.com/apis/console/" class="uri">https://code.google.com/apis/console/</a>)</li>
<li>Check you are <strong>signed into Google</strong> with the account you wish to use.</li>
<li>Choose <strong>Create Project</strong> from the Google API Console and give your project a name (or choose an existing project if you have one already).</li>
<li>From the <strong>APIs</strong> page, enable the <strong>Analytics API</strong>. You may also want to enable the <strong>Tag Manager API</strong> if you wish to try that.</li>
<li>You will need to <strong>agree</strong> and <strong>accept</strong> the Google APIs and Analytics API Terms of Service to proceed.</li>
<li>Go to the <strong>Credentials</strong> page, click <strong>Add credentials</strong>, choose <strong>OAuth 2.0 client ID</strong>, then select “Other”.</li>
<li>Note your <strong>Client ID</strong> and <strong>Client Secret</strong> and download the JSON file to your R working directory.</li>
</ul>
<p><em>Note: For further information about Google APIs, please refer to the <a href="https://github.com/jdeboer/ganalytics/blob/master/README.md#useful-references">References section</a> at the end of this document.</em></p>
</div>
<div id="set-your-system-environment-variables-this-is-optional-but-recommended" class="section level3">
<h3>3. Set your system environment variables <em>(this is optional but recommended)</em></h3>
<ul>
<li><p>Add the following two user variables:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Variable name</th>
<th>Variable value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>GOOGLE_APIS_CONSUMER_ID</code></td>
<td><code>&lt;Your client ID&gt;</code></td>
</tr>
<tr class="even">
<td>2</td>
<td><code>GOOGLE_APIS_CONSUMER_SECRET</code></td>
<td><code>&lt;Your client secret&gt;</code></td>
</tr>
</tbody>
</table>
<ul>
<li>To do this in Windows:
<ul>
<li>Search for and select <strong>“Edit Environment Variables For Your Account”</strong> from the Start menu.</li>
<li>Within the <strong>Environment Variables</strong> window, add the above <strong>User Variables</strong> by selecting <strong>New</strong> and entering the <strong>Variable Name</strong> and <strong>Variable Value</strong>, then click <strong>OK</strong>. Do this for both variables listed in the table above.</li>
<li>Click <strong>OK</strong>.</li>
<li><strong>Restart</strong> your computer for the new environment variables to take effect.</li>
</ul></li>
<li>There is also a free open source utility to set environment variables on Mac OS called <a href="https://github.com/hschmidt/EnvPane">EnvPane</a></li>
<li>Another method that works across platforms is to create an <code>.Renviron</code> file within your active R working directory that is structured like this:</li>
</ul></li>
</ul>
<pre><code>GOOGLE_APIS_CONSUMER_ID = &lt;Your client ID&gt;
GOOGLE_APIS_CONSUMER_SECRET = &lt;Your client secret&gt;</code></pre>
<p><strong>Alternatively</strong> you can temporarily set your environment variables straight from R using this command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">Sys.setenv</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">GOOGLE_APIS_CONSUMER_ID =</span> <span class="st">&quot;&lt;Your client ID&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">GOOGLE_APIS_CONSUMER_SECRET =</span> <span class="st">&quot;&lt;Your client secret&gt;&quot;</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">)</a></code></pre></div>
<p><em>Note: For other operating systems please refer to the Reference section at the end of this document.</em></p>
</div>
<div id="authenticate-and-attempt-your-first-query-with-ganalytics" class="section level3">
<h3>4. Authenticate and attempt your first query with ganalytics</h3>
<ul>
<li>ganalytics needs to know the ID of the Google Analytics <strong>view</strong> that you wish to query. You can obtain this in a number of ways:
<ul>
<li>Using the <a href="https://ga-dev-tools.appspot.com/explorer/">Google Analytics Query Explorer tool</a></li>
<li>From the <strong>Admin page</strong> in Google Analytics under <strong>View Settings</strong>, or</li>
<li>The browser’s address bar while viewing a report in Google Analytics - look for the digits between the letter <strong>‘p’</strong> and trailing <strong>‘/’</strong>, e.g. <code>.../a11111111w22222222p33333333/</code> shows a view ID of <code>33333333</code>.</li>
</ul></li>
<li><strong>Alternatively, ganalytics can look up the view ID for you:</strong>
<ul>
<li>If you have access to only one Google Analytics account, with one property, then ganalytics will automatically select the default view for you from that property.</li>
<li>Otherwise it will select the default view of the first property from the first account that it finds in the list of accounts that you have access to.</li>
</ul></li>
<li><p>Return to R and execute the following to load the ganalytics package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(ganalytics)</a></code></pre></div></li>
<li><p>If you have successfully set your system environment variables in step 3 above, then you can execute the following, optionally providing the email address you use to sign-in to Google Analytics:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">my_creds &lt;-<span class="st"> </span><span class="kw">GoogleApiCreds</span>(<span class="st">&quot;you@domain.com&quot;</span>)</a></code></pre></div></li>
<li>Otherwise do one of the following:
<ul>
<li><p>If you downloaded the JSON file containing your Google API app credentials, then provide the file path:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">my_creds &lt;-<span class="st"> </span><span class="kw">GoogleApiCreds</span>(<span class="st">&quot;you@domain.com&quot;</span>, <span class="st">&quot;client_secret.json&quot;</span>)</a></code></pre></div></li>
<li><p>Or, instead of a file you can supply the <code>client_id</code> and <code>client_secret</code> directly:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">my_creds &lt;-<span class="st"> </span><span class="kw">GoogleApiCreds</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="st">&quot;you@domain.com&quot;</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">client_id =</span> <span class="st">&quot;&lt;client id&gt;&quot;</span>, <span class="dt">client_secret =</span> <span class="st">&quot;&lt;client secret&gt;&quot;</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">)</a></code></pre></div></li>
</ul></li>
<li><p>Now formulate and run your Google Analytics query, remembering to substitute <code>view_id</code> with the view ID you wish to use:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">myQuery &lt;-<span class="st"> </span><span class="kw">GaQuery</span>( view_id, <span class="dt">creds =</span> my_creds ) <span class="co"># view_id is optional</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">GetGaData</span>(myQuery)</a></code></pre></div></li>
<li>You should then be directed to <em>accounts.google.com</em> within your default web browser asking you to sign-in to your Google account if you are not already. Once signed-in you will be asked to grant read-only access to your Google Analytics account for the Google API project you created in step 1.</li>
<li><p>Make sure you are signed into the Google account you wish to use, then grant access by selecting <strong>“Allow access”</strong>. You can then close the page and return back to R.</p></li>
</ul>
<p>If you have successfully executed all of the above R commands you should see the output of the default ganalytics query; sessions by day for the past 7 days. For example:</p>
<pre><code>        date sessions
1 2015-03-27     2988
2 2015-03-28     1594
3 2015-03-29     1912
4 2015-03-30     3061
5 2015-03-31     2609
6 2015-04-01     2762
7 2015-04-02     2179
8 2015-04-03     1552</code></pre>
<p><em>Note: A small file will be saved to your home directory (‘My Documents’ in Windows) to cache your new reusable authentication token.</em></p>
</div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>As demonstrated in the installation steps above, before executing any of the following examples:</p>
<ol style="list-style-type: decimal">
<li>Load the ganalytics package</li>
<li>Generate a <code>gaQuery</code> object using the <code>GaQuery()</code> function and assigning the object to a variable name such as <code>myQuery</code>.</li>
</ol>
<div id="asumptions" class="section level3">
<h3>Asumptions</h3>
<p><strong>The following examples assume you have successfully completed the above steps and have named your Google Analytics query object: <code>myQuery</code>.</strong></p>
</div>
<div id="example-1---setting-the-date-range" class="section level3">
<h3>Example 1 - Setting the date range</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># Set the date range from 1 January 2013 to 31 May 2013: (Dates are specified in the format &quot;YYYY-MM-DD&quot;.)</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">DateRange</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2013-01-01&quot;</span>, <span class="st">&quot;2013-05-31&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co"># Adjust the start date to 1 March 2013:</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="kw">StartDate</span>(myQuery) &lt;-<span class="st"> &quot;2013-03-01&quot;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># Adjust the end date to 31 March 2013:</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="kw">EndDate</span>(myQuery) &lt;-<span class="st"> &quot;2013-03-31&quot;</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-2---choosing-what-metrics-to-report" class="section level3">
<h3>Example 2 - Choosing what metrics to report</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Report number of page views instead</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">Metrics</span>(myQuery) &lt;-<span class="st"> &quot;pageviews&quot;</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co"># Report both pageviews and sessions</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw">Metrics</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pageviews&quot;</span>, <span class="st">&quot;sessions&quot;</span>)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co"># These variations are also acceptable</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="kw">Metrics</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ga:pageviews&quot;</span>, <span class="st">&quot;ga.sessions&quot;</span>)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-3---selecting-what-dimensions-to-split-your-metrics-by" class="section level3">
<h3>Example 3 - Selecting what dimensions to split your metrics by</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Similar to metrics, but for dimensions</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;dayOfWeekName&quot;</span>, <span class="st">&quot;hour&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># Lets set a wider date range</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">DateRange</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2012-10-01&quot;</span>, <span class="st">&quot;2013-03-31&quot;</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw">tail</span>(myData)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-4---sort-by" class="section level3">
<h3>Example 4 - Sort by</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># Sort by descending number of pageviews</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">SortBy</span>(myQuery) &lt;-<span class="st"> &quot;-pageviews&quot;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">tail</span>(myData)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-5---row-filters" class="section level3">
<h3>Example 5 - Row filters</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Filter for Sunday sessions only</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">sundayExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>dayOfWeekName <span class="op">==</span><span class="st"> &quot;Sunday&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span>sundayExpr</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co"># Remove the filter</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-6---combining-filters-with-and" class="section level3">
<h3>Example 6 - Combining filters with AND</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Expression to define Sunday sessions</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">sundayExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>dayOfWeekName <span class="op">==</span><span class="st"> &quot;Sunday&quot;</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co"># Expression to define organic search sessions</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">organicExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>medium <span class="op">==</span><span class="st"> &quot;organic&quot;</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co"># Expression to define organic search sessions made on a Sunday</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">sundayOrganic &lt;-<span class="st"> </span>sundayExpr <span class="op">&amp;</span><span class="st"> </span>organicExpr</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span>sundayOrganic</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11"></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co"># Let's concatenate medium to the dimensions for our query</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">Dimensions</span>(myQuery), <span class="st">&quot;medium&quot;</span>)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-7---combining-filters-with-or" class="section level3">
<h3>Example 7 - Combining filters with OR</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># In a similar way to AND</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">loyalExpr &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">Expr</span>(<span class="op">~</span>sessionCount <span class="op">%matches%</span><span class="st"> &quot;^[0-3]$&quot;</span>) <span class="co"># Made more than 3 sessions</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">recentExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>daysSinceLastSession <span class="op">%matches%</span><span class="st"> &quot;^[0-6]$&quot;</span>) <span class="co"># Visited sometime within the past 7 days.</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">loyalOrRecent &lt;-<span class="st"> </span>loyalExpr <span class="op">|</span><span class="st"> </span>recentExpr</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span>loyalOrRecent</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-8---filters-that-combine-ors-with-ands" class="section level3">
<h3>Example 8 - Filters that combine ORs with ANDs</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">loyalExpr &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">Expr</span>(<span class="op">~</span>sessionCount <span class="op">%matches%</span><span class="st"> &quot;^[0-3]$&quot;</span>) <span class="co"># Made more than 3 sessions</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">recentExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>daysSinceLastSession <span class="op">%matches%</span><span class="st"> &quot;^[0-6]$&quot;</span>) <span class="co"># Visited sometime within the past 7 days.</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">loyalOrRecent &lt;-<span class="st"> </span>loyalExpr <span class="op">|</span><span class="st"> </span>recentExpr</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">sundayExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>dayOfWeekName <span class="op">==</span><span class="st"> &quot;Sunday&quot;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">loyalOrRecent_Sunday &lt;-<span class="st"> </span>loyalOrRecent <span class="op">&amp;</span><span class="st"> </span>sundayExpr</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span>loyalOrRecent_Sunday</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co"># Perform the same query but change which dimensions to view</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sessionCount&quot;</span>, <span class="st">&quot;daysSinceLastSession&quot;</span>, <span class="st">&quot;dayOfWeek&quot;</span>)</a>
<a class="sourceLine" id="cb17-13" data-line-number="13"></a>
<a class="sourceLine" id="cb17-14" data-line-number="14">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="kw">summary</span>(myData)</a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-9---sorting-numeric-dimensions-continuing-from-example-8" class="section level3">
<h3>Example 9 - Sorting ‘numeric’ dimensions (continuing from example 8)</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Continuing from example 8...</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># Change filter to loyal session AND recent sessions AND visited on Sunday</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">loyalAndRecent_Sunday &lt;-<span class="st"> </span>loyalExpr <span class="op">&amp;</span><span class="st"> </span>recentExpr <span class="op">&amp;</span><span class="st"> </span>sundayExpr</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span>loyalAndRecent_Sunday</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co"># Sort by decending visit count and ascending days since last visit.</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="kw">SortBy</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;-sessionCount&quot;</span>, <span class="st">&quot;+daysSinceLastSession&quot;</span>)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb18-11" data-line-number="11"></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co"># Notice that the Google Analytics Core Reporting API doesn't recognise 'numerical' dimensions as</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co"># ordered factors when sorting. We can use R to sort instead, such as using dplyr.</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">myData &lt;-<span class="st"> </span>myData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(sessionCount), daysSinceLastSession)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="kw">tail</span>(myData)</a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-10---session-segmentation" class="section level3">
<h3>Example 10 - Session segmentation</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Visit segmentation is expressed similarly to row filters and supports AND and OR combinations.</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># Define a segment for sessions where a &quot;thank-you&quot;, &quot;thankyou&quot; or &quot;success&quot; page was viewed.</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">thankyouExpr &lt;-<span class="st"> </span><span class="kw">Expr</span>(<span class="op">~</span>pagePath <span class="op">%matches%</span><span class="st"> &quot;thank</span><span class="ch">\\</span><span class="st">-?you|success&quot;</span>)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw">Segments</span>(myQuery) &lt;-<span class="st"> </span>thankyouExpr</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co"># Reset the filter</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co"># Split by traffic source and medium</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;source&quot;</span>, <span class="st">&quot;medium&quot;</span>)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co"># Sort by decending number of sessions</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="kw">SortBy</span>(myQuery) &lt;-<span class="st"> &quot;-sessions&quot;</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"></a>
<a class="sourceLine" id="cb19-15" data-line-number="15">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="kw">head</span>(myData)</a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-11---using-automatic-pagination-to-get-more-than-10000-rows-of-data-per-query" class="section level3">
<h3>Example 11 - Using automatic pagination to get more than 10,000 rows of data per query</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Sessions by date and hour for the years 2016 and 2017:</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co"># First let's clear any filters or segments defined previously</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="kw">Segments</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co"># Define our date range</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="kw">DateRange</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2016-01-01&quot;</span>, <span class="st">&quot;2017-12-31&quot;</span>)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co"># Define our metrics and dimensions</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="kw">Metrics</span>(myQuery) &lt;-<span class="st"> &quot;sessions&quot;</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;dayOfWeekName&quot;</span>, <span class="st">&quot;hour&quot;</span>)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co"># Let's allow a maximum of 20000 rows (default is 10000)</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="kw">MaxResults</span>(myQuery) &lt;-<span class="st"> </span><span class="dv">20000</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"></a>
<a class="sourceLine" id="cb20-13" data-line-number="13">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="kw">nrow</span>(myData)</a>
<a class="sourceLine" id="cb20-15" data-line-number="15"></a>
<a class="sourceLine" id="cb20-16" data-line-number="16">## Let's use dplyr to analyse the data</a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb20-18" data-line-number="18"></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co"># Sessions by day of week</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20">sessions_by_dayOfWeek &lt;-<span class="st"> </span>myData <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-21" data-line-number="21"><span class="st">  </span><span class="kw">count</span>(dayOfWeekName, <span class="dt">wt =</span> sessions) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dayOfWeekName =</span> <span class="kw">factor</span>(dayOfWeekName, <span class="dt">levels =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb20-23" data-line-number="23">    <span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Tuesday&quot;</span>, <span class="st">&quot;Wednesday&quot;</span>, <span class="st">&quot;Thursday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24">  ), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span>, <span class="st">&quot;Sun&quot;</span>), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="st">  </span><span class="kw">arrange</span>(dayOfWeekName)</a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb20-27" data-line-number="27">  sessions_by_dayOfWeek,</a>
<a class="sourceLine" id="cb20-28" data-line-number="28">  <span class="kw">barplot</span>(n, <span class="dt">names.arg =</span> dayOfWeekName, <span class="dt">xlab =</span> <span class="st">&quot;day of week&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;sessions&quot;</span>)</a>
<a class="sourceLine" id="cb20-29" data-line-number="29">)</a>
<a class="sourceLine" id="cb20-30" data-line-number="30"></a>
<a class="sourceLine" id="cb20-31" data-line-number="31"><span class="co"># Sessions by hour of day</span></a>
<a class="sourceLine" id="cb20-32" data-line-number="32">sessions_by_hour &lt;-<span class="st"> </span>myData <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-33" data-line-number="33"><span class="st">  </span><span class="kw">count</span>(hour, <span class="dt">wt =</span> sessions)</a>
<a class="sourceLine" id="cb20-34" data-line-number="34"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb20-35" data-line-number="35">  sessions_by_hour,</a>
<a class="sourceLine" id="cb20-36" data-line-number="36">  <span class="kw">barplot</span>(n, <span class="dt">names.arg =</span> hour, <span class="dt">xlab =</span> <span class="st">&quot;hour&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;sessions&quot;</span>)</a>
<a class="sourceLine" id="cb20-37" data-line-number="37">)</a>
<a class="sourceLine" id="cb20-38" data-line-number="38"><span class="co"># End</span></a></code></pre></div>
</div>
<div id="example-12---using-ggplot2" class="section level3">
<h3>Example 12 - Using ggplot2</h3>
<p>To run this example first install ggplot2 if you haven’t already.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</a></code></pre></div>
<p>Once installed, then run the following example.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co"># Sessions by date and hour for the years 2016 and 2017:</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co"># First let's clear any filters or segments defined previously</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="kw">TableFilter</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="kw">Segments</span>(myQuery) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co"># Define our date range</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="kw">DateRange</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2016-01-01&quot;</span>, <span class="st">&quot;2017-12-31&quot;</span>)</a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co"># Define our metrics and dimensions</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw">Metrics</span>(myQuery) &lt;-<span class="st"> &quot;sessions&quot;</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="kw">Dimensions</span>(myQuery) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;dayOfWeek&quot;</span>, <span class="st">&quot;hour&quot;</span>, <span class="st">&quot;deviceCategory&quot;</span>)</a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co"># Let's allow a maximum of 40000 rows (default is 10000)</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="kw">MaxResults</span>(myQuery) &lt;-<span class="st"> </span><span class="dv">40000</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"></a>
<a class="sourceLine" id="cb22-16" data-line-number="16">myData &lt;-<span class="st"> </span><span class="kw">GetGaData</span>(myQuery)</a>
<a class="sourceLine" id="cb22-17" data-line-number="17"></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co"># Sessions by hour of day and day of week</span></a>
<a class="sourceLine" id="cb22-19" data-line-number="19">avg_sessions_by_hour_wday_device &lt;-<span class="st"> </span>myData <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="st">  </span><span class="kw">group_by</span>(hour, dayOfWeek, deviceCategory) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-21" data-line-number="21"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sessions =</span> <span class="kw">mean</span>(sessions)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-22" data-line-number="22"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb22-23" data-line-number="23"></a>
<a class="sourceLine" id="cb22-24" data-line-number="24"><span class="co"># Relabel the days of week</span></a>
<a class="sourceLine" id="cb22-25" data-line-number="25"><span class="kw">levels</span>(avg_sessions_by_hour_wday_device<span class="op">$</span>dayOfWeek) &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb22-26" data-line-number="26">  <span class="st">&quot;Sun&quot;</span>, <span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span></a>
<a class="sourceLine" id="cb22-27" data-line-number="27">)</a>
<a class="sourceLine" id="cb22-28" data-line-number="28"></a>
<a class="sourceLine" id="cb22-29" data-line-number="29"><span class="co"># Plot the summary data</span></a>
<a class="sourceLine" id="cb22-30" data-line-number="30"><span class="kw">qplot</span>(</a>
<a class="sourceLine" id="cb22-31" data-line-number="31">  <span class="dt">x =</span> hour,</a>
<a class="sourceLine" id="cb22-32" data-line-number="32">  <span class="dt">y =</span> sessions,</a>
<a class="sourceLine" id="cb22-33" data-line-number="33">  <span class="dt">data =</span> avg_sessions_by_hour_wday_device,</a>
<a class="sourceLine" id="cb22-34" data-line-number="34">  <span class="dt">facets =</span> <span class="op">~</span>dayOfWeek,</a>
<a class="sourceLine" id="cb22-35" data-line-number="35">  <span class="dt">fill =</span> deviceCategory,</a>
<a class="sourceLine" id="cb22-36" data-line-number="36">  <span class="dt">geom =</span> <span class="st">&quot;col&quot;</span></a>
<a class="sourceLine" id="cb22-37" data-line-number="37">)</a>
<a class="sourceLine" id="cb22-38" data-line-number="38"></a>
<a class="sourceLine" id="cb22-39" data-line-number="39"><span class="co"># End</span></a></code></pre></div>
</div>
</div>
<div id="thanks-to" class="section level2">
<h2>Thanks to:</h2>
<ul>
<li>Hadley Wickham <span class="citation">@hadley</span></li>
<li>Mark Edmondson <span class="citation">@MarkEdmondson1234</span></li>
<li>RStudio team</li>
<li>R Core team</li>
</ul>
</div>
<div id="useful-references" class="section level2">
<h2>Useful references</h2>
<ol style="list-style-type: decimal">
<li><a href="https://developers.google.com/analytics/devguides/reporting/core/v3/reference">Google Analytics Core Reporting API reference guide</a></li>
<li><a href="https://developers.google.com/analytics/devguides/reporting/core/dimsmets">Google Analytics Dimensions and Metrics reference</a></li>
<li><a href="https://developers.google.com/console/help/#creatingdeletingprojects">Creating a Google API project</a></li>
<li><a href="https://developers.google.com/console/help/#generatingoauth2">Generating an OAuth 2.0 client ID for Google APIs</a></li>
<li><a href="https://developers.google.com/accounts/docs/OAuth2InstalledApp">Using OAuth 2.0 for Installed Applications</a></li>
<li><a href="https://github.com/hschmidt/EnvPane">EnvPane utility for setting environment variables in OSX</a></li>
<li><a href="https://help.ubuntu.com/community/EnvironmentVariables">Setting environment variables in Ubuntu Linux</a></li>
</ol>
</div>
<div id="notes" class="section level2">
<h2>Notes</h2>
<p>Please note that this project is released with a <a href="CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
<p>Google Analytics and Google Tag Manager are trademarks of Google.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
