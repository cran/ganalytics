<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Setup/Config</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p><code>ganalytics</code> provides functions that makes it easy to define filters and segments using natural R language comparison and logical operators. This example demonstrates how to define dynamic segments using functions from the <code>ganalytics</code> package and using those segments with the <code>googleAnalyticsR</code> package. The current development version of <code>googleAnalyticsR</code> supports segments and filters defined with <code>ganalytics</code>.</p>

<h2>Setup/Config</h2>

<p>Once installed, load these packages. Please refer to the <code>googleAnalyticsR</code> package documentation on configuration steps you may need to complete in order to use the Google Analytics APIs.</p>

<pre><code class="r">library(googleAnalyticsR)
</code></pre>

<pre><code>## 2019-03-02 20:01:49&gt; Set API cache
</code></pre>

<pre><code>## 2019-03-02 20:01:49&gt; No environment argument found, looked in GA_AUTH_FILE
</code></pre>

<pre><code class="r">library(ganalytics)
</code></pre>

<pre><code>## Welcome to ganalytics.
## 
## To get started, use the GoogleApiCreds() function to set credentials for
## authenticating with your Google Analytics API project. E.g:
##  creds &lt;- GoogleApiCreds(&quot;&lt;my_user_name&gt;@gmail.com&quot;, &quot;.my_app_oauth_creds.json&quot;)
## 
## Then, check out the list of available demos and package documentation with:
##  vignette(package = &quot;ganalytics&quot;)
##  vignette(&quot;README&quot;,  &quot;ganalytics&quot;)
##  package?ganalytics
##  demo(package = &quot;ganalytics&quot;)
##  demo(&quot;gademo&quot;, &quot;ganalytics&quot;)
## 
## For help with authentication, enter:
##  ?ganalytics::GoogleApiCreds
## 
## Please note: Authentication will automatically direct you to Google&#39;s website
## where you will be asked to grant permission for your project to access Google
## Analytics - this will open within your default web browser. Unless a file path
## is provided at the time of authentication, tokens will be cached by httr in your
## home directory.
</code></pre>

<pre><code class="r">library(dplyr)
</code></pre>

<pre><code>## 
## Attaching package: &#39;dplyr&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
</code></pre>

<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</code></pre>

<pre><code class="r">library(tidyr)
library(ggplot2)
library(purrr)
library(knitr)

ga_auth(file.path(&quot;~&quot;, &quot;ga.oauth&quot;))
</code></pre>

<pre><code>## Token cache file: ~/ga.oauth
</code></pre>

<pre><code class="r">view_id &lt;- &quot;117987738&quot;
start_date &lt;- &quot;2018-05-01&quot;
end_date &lt;- &quot;2018-06-30&quot;
</code></pre>

<h2>Pull the Data</h2>

<p>In this example, we&#39;ll define a list of six segments:</p>

<ul>
<li>Bounced sessions: Sessions where the bounces metric is not zero.</li>
<li>Mobile or tablet sessions: Sessions by mobile and tablet users.</li>
<li>Converters: Users who performed any type of conversion during the defined date range.</li>
<li>Multi-session users: Users who have visited more than once during the defined date range.</li>
<li>New desktop users: Sessions by new visitors using a desktop device.</li>
<li>Bounced before converting = Users who bounced in one session before converting later.</li>
</ul>

<p>The above list of dynamic segments is defined using <code>ganalytics</code> expressions as follows:</p>

<pre><code class="r">bounces &lt;- Expr(~bounces != 0)
conversions &lt;- Expr(~goalCompletionsAll &gt; 0) | Expr(~transactions &gt; 0)
mobile_or_tablet &lt;- Expr(~deviceCategory %in% c(&quot;mobile&quot;, &quot;tablet&quot;))
multi_session_users &lt;- Include(PerUser(Expr(~sessions &gt; 1)), scope = &quot;users&quot;)
new_desktop_users &lt;- Expr(~deviceCategory == &quot;desktop&quot;) &amp; Expr(~userType == &quot;new&quot;)

my_segment_list &lt;- list(
  bounced_sessions = PerSession(bounces),
  mobile_or_tablet = mobile_or_tablet,
  converters = PerUser(conversions),
  multi_session_users = multi_session_users,
  new_desktop_users = new_desktop_users,
  bounced_before_converting = Sequence(bounces, conversions, scope = &quot;users&quot;)
)
</code></pre>

<p>Because the Google Analytics Reporting API can only be used to query 4 segments at a time, we need to break our list segments into chunks.</p>

<pre><code class="r">segment_chunks &lt;- split(my_segment_list, (seq_along(my_segment_list) - 1L) %/% 4L)
</code></pre>

<p>We can now use <code>googleAnalyticsR</code> to query each chunk of segments and bind the results into a single <code>data.frame</code>. For each segment, we will request a count of users and sessions.</p>

<pre><code class="r">results &lt;- map_df(segment_chunks, function(chunk) {
  google_analytics(
    viewId = view_id,
    date_range = c(start_date, end_date),
    metrics = c(&quot;users&quot;, &quot;sessions&quot;),
    dimensions = c(&quot;segment&quot;),
    segments = Segments(chunk)
  )
})
</code></pre>

<pre><code class="r">kable(results)
</code></pre>

<table><thead>
<tr>
<th align="left">segment</th>
<th align="right">users</th>
<th align="right">sessions</th>
</tr>
</thead><tbody>
<tr>
<td align="left">bounced_sessions</td>
<td align="right">839</td>
<td align="right">991</td>
</tr>
<tr>
<td align="left">converters</td>
<td align="right">1066</td>
<td align="right">1388</td>
</tr>
<tr>
<td align="left">mobile_or_tablet</td>
<td align="right">322</td>
<td align="right">437</td>
</tr>
<tr>
<td align="left">multi_session_users</td>
<td align="right">171</td>
<td align="right">519</td>
</tr>
<tr>
<td align="left">bounced_before_converting</td>
<td align="right">667</td>
<td align="right">950</td>
</tr>
<tr>
<td align="left">new_desktop_users</td>
<td align="right">962</td>
<td align="right">933</td>
</tr>
</tbody></table>

<h2>Data Munging and Visualization</h2>

<p>We will compare users and sessions for each segment using a horizontal column chart. To do this we need to transform the results table into long format in which the count of users and sessions for each segment are on separate rows.</p>

<pre><code class="r">results_long &lt;- results %&gt;%
  gather(metric, count, users, sessions)
</code></pre>

<pre><code class="r">kable(results_long)
</code></pre>

<table><thead>
<tr>
<th align="left">segment</th>
<th align="left">metric</th>
<th align="right">count</th>
</tr>
</thead><tbody>
<tr>
<td align="left">bounced_sessions</td>
<td align="left">users</td>
<td align="right">839</td>
</tr>
<tr>
<td align="left">converters</td>
<td align="left">users</td>
<td align="right">1066</td>
</tr>
<tr>
<td align="left">mobile_or_tablet</td>
<td align="left">users</td>
<td align="right">322</td>
</tr>
<tr>
<td align="left">multi_session_users</td>
<td align="left">users</td>
<td align="right">171</td>
</tr>
<tr>
<td align="left">bounced_before_converting</td>
<td align="left">users</td>
<td align="right">667</td>
</tr>
<tr>
<td align="left">new_desktop_users</td>
<td align="left">users</td>
<td align="right">962</td>
</tr>
<tr>
<td align="left">bounced_sessions</td>
<td align="left">sessions</td>
<td align="right">991</td>
</tr>
<tr>
<td align="left">converters</td>
<td align="left">sessions</td>
<td align="right">1388</td>
</tr>
<tr>
<td align="left">mobile_or_tablet</td>
<td align="left">sessions</td>
<td align="right">437</td>
</tr>
<tr>
<td align="left">multi_session_users</td>
<td align="left">sessions</td>
<td align="right">519</td>
</tr>
<tr>
<td align="left">bounced_before_converting</td>
<td align="left">sessions</td>
<td align="right">950</td>
</tr>
<tr>
<td align="left">new_desktop_users</td>
<td align="left">sessions</td>
<td align="right">933</td>
</tr>
</tbody></table>

<pre><code class="r">ggplot(results_long) +
  aes(segment, count, fill = metric) +
  geom_col(position = &quot;dodge&quot;) +
  guides(fill = guide_legend(reverse = TRUE)) +
  coord_flip() +
  theme(axis.text.y.left = element_text(hjust = 0))
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk visualize-results"/></p>

</body>

</html>
